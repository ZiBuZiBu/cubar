---
title: "Introduction"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(Biostrings)
library(data.table)
library(ggplot2)
```

```{r load cubar}
rm(list = ls())
devtools::load_all()
```

Useful functions
```{r}
usethis::use_data(yeast_half_life)
```

```{r}
# example dataset
yeast_cds

# get codon frequency
yeast_cf <- count_codons(yeast_cds)

# get codon table
ctab <- get_codon_table()

# get enc
enc <- get_enc(yeast_cds)

# calculate optimal codons
optimal_codons <- get_optimal_codons(yeast_cds)

# get fop
fop <- get_fop(yeast_cds)
hist(fop)
```

```{r testing}
f <- function(a, b){
    if(missing(b)){
        b <- 20
    }
    return(a + b)
}
```

Codon stabilizaiton coefficients
Yeast mRNA half life data from:
> Presnyak V, Alhusaini N, Chen YH, et al. Codon optimality is a major determinant of mRNA stability. Cell. 2015;160(6):1111-1124. doi:10.1016/j.cell.2015.02.029

```{r}
library(readxl)
library(dplyr)
library(janitor)
yeast_hf <- read_excel('./tmp/Presnyak2015_tableS1_yeast_rna_half_life.xls')
yeast_hf <- clean_names(yeast_hf)
yeast_hf <- yeast_hf |> select(gene_id, gene_name, half_life = total_half_life)

yeast_cf <- count_codons(yeast_cds)
yeast_cf <- yeast_cf[, !colnames(yeast_cf) %in% c('TAA', 'TAG', 'TGA')]
yeast_cp <- yeast_cf / rowSums(yeast_cf)

common_genes <- intersect(rownames(yeast_cp), yeast_hf$gene_id)
yeast_hf <- yeast_hf |> filter(gene_id %in% common_genes)
yeast_cp <- yeast_cp[yeast_hf$gene_id,]

csc <- apply(yeast_cp, 2, function(prop){
    res <- cor.test(prop, yeast_hf$half_life)
    c(corr = res$estimate, pvalue = res$p.value)
})
csc <- data.table(t(csc), keep.rownames = TRUE)
setnames(csc, c('codon', 'csc', 'pvalue'))

```

Test codon table specification
```{r}
f <- function(seqs, codon_table = get_codon_table(), ignore = TRUE){
    print(codon_table)
    return(0)
}
```
