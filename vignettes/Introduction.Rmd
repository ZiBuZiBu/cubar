---
title: "Introduction"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(Biostrings)
library(data.table)
library(ggplot2)
library(cubar)
```

### Common analyses
Sequences handling and codon table
```{r}
# example data
yeast_cds
yeast_cds_qc <- check_cds(yeast_cds)

# convert a CDS to codon sequence
seq_to_codons(yeast_cds_qc[['YDR320W-B']])

# convert a CDS to amino acid sequence
Biostrings::translate(yeast_cds_qc[['YDR320W-B']])

# get codon frequency
yeast_cf <- count_codons(yeast_cds_qc)

# get codon table for the standard genetic code
ctab <- get_codon_table(gcid = '1')
```

Effective number of codons (ENC)
```{r}
# get enc
yeast_enc <- get_enc(yeast_cf)
head(yeast_enc)
hist(yeast_enc)
```

Fraction of optimal codons (Fop)
```{r}
# estimate optimal codons
optimal_codons <- est_optimal_codons(yeast_cds_qc, codon_table = ctab)
optimal_codons

# get fop
fop <- get_fop(yeast_cds)
hist(fop)
```

Codon Adaptation Index (CAI)
```{r}
# estimate RSCU
rscu <- est_rscu(yeast_cf, codon_table = ctab)

# calculate CAI
# note: CAI values are usually calculated based RSCU of highly expressed genes.
cai <- get_cai(yeast_cf, rscu = rscu)
hist(cai)
```

tRNA Adaptation Index (tAI)
```{r}
# get tRNA gene copy number from GtRNADB
path_gtrnadb <- 'http://gtrnadb.ucsc.edu/genomes/eukaryota/Scere3/sacCer3-mature-tRNAs.fa'
yeast_trna <- Biostrings::readRNAStringSet(path_gtrnadb)
trna_gcn <- table(data.table::tstrsplit(sub(' .*', '', names(yeast_trna)), '-')[[3]])
trna_gcn <- trna_gcn[names(trna_gcn) != 'NNN'] # copy of each anticodon

# calculate tRNA weight for each codon
trna_w <- est_trna_weight(trna_level = trna_gcn, codon_table = ctab)

# get tAI
tai <- get_tai(yeast_cf, trna_w = trna_w)
hist(tai)
```


#### References

> Presnyak V, Alhusaini N, Chen YH, et al. Codon optimality is a major determinant of mRNA stability. Cell. 2015;160(6):1111-1124. doi:10.1016/j.cell.2015.02.029

